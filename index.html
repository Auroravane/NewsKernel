<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsKernal | Daily Tech Brief</title>
    <style>
        :root { --primary: #FF4C29; --bg: #080808; --surface: #1a1a1a; --text: #eaeaea; }
        body { background: var(--bg); color: var(--text); font-family: 'Helvetica Neue', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        
        .brand { font-size: 2.5rem; font-weight: 800; letter-spacing: -2px; margin-bottom: 5px; }
        .brand span { color: var(--primary); }
        .tagline { color: #666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 40px; }

        .player { background: var(--surface); padding: 40px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.6); border: 1px solid #333; position: relative; overflow: hidden; }
        
        /* Status Indicator */
        .status-dot { height: 10px; width: 10px; background-color: #444; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .live { background-color: var(--primary); box-shadow: 0 0 10px var(--primary); animation: pulse 2s infinite; }
        
        .date { font-size: 0.85rem; color: #888; margin-bottom: 30px; display: block; }
        
        button { background: var(--primary); color: white; border: none; padding: 18px 40px; font-size: 1.2rem; font-weight: bold; border-radius: 12px; cursor: pointer; width: 100%; transition: all 0.2s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255, 76, 41, 0.2); }
        
        .transcript-box { margin-top: 25px; text-align: left; font-size: 0.9rem; line-height: 1.6; color: #bbb; max-height: 150px; overflow-y: auto; display: none; padding: 15px; background: #111; border-radius: 8px; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div class="brand">News<span>Kernal</span></div>
    <div class="tagline">The Signal in the Noise</div>

    <div class="player">
        <div style="margin-bottom: 15px;">
            <span class="status-dot" id="dot"></span>
            <span id="statusText">System Initializing...</span>
        </div>
        <span class="date" id="dateDisplay">--</span>

        <button id="playBtn" onclick="toggleAudio()">▶ Listen to Brief</button>
        <audio id="audioElement" style="display:none"></audio>
        
        <div class="transcript-box" id="transcript"></div>
    </div>

    <script>
        // REPLACE THIS URL with your Supabase Storage URL
        // Go to Supabase -> Storage -> "briefs" bucket -> Click "Get Public URL" on any file -> Copy the base part
        const STORAGE_URL = "https://sfirrnvluecsmwvyfavr.supabase.cos";

        const audio = document.getElementById('audioElement');
        const btn = document.getElementById('playBtn');

        async function initNewsKernal() {
            try {
                // Fetch Metadata (Text & Date)
                const res = await fetch(`${STORAGE_URL}/public/latest_data.json?t=${Date.now()}`);
                if (!res.ok) throw new Error("Offline");
                
                const data = await res.json();
                
                // Update UI
                document.getElementById('dateDisplay').innerText = data.date;
                document.getElementById('transcript').innerText = data.summary;
                document.getElementById('statusText').innerText = "Broadcast Ready";
                document.getElementById('dot').classList.add('live');
                
                // Preload Audio
                audio.src = `${STORAGE_URL}/public/latest_brief.mp3?t=${Date.now()}`;
                
            } catch (e) {
                document.getElementById('statusText').innerText = "Broadcast Offline";
                btn.disabled = true;
                btn.style.background = "#333";
                btn.innerText = "No Brief Available";
            }
        }

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                btn.innerHTML = "⏸ Pause Brief";
                document.getElementById('transcript').style.display = 'block';
            } else {
                audio.pause();
                btn.innerHTML = "▶ Resume Brief";
            }
        }

        initNewsKernal();
    </script>
</body>
</html>
